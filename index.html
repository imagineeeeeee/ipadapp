<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Store Management Dashboard</title>
    <!-- Tailwind CSS for modern and responsive styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for the app */
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 antialiased">

    <!-- Main container for the entire application -->
    <div class="min-h-screen flex flex-col p-4">

        <!-- Header for all pages -->
        <header class="bg-white rounded-3xl shadow-lg p-4 flex justify-between items-center mb-6">
            <h1 class="text-2xl md:text-3xl font-bold text-gray-900">Store</h1>
            <nav class="flex space-x-2">
                <button id="home-nav-btn" class="text-sm md:text-base font-semibold py-2 px-4 rounded-xl text-white bg-blue-600 hover:bg-blue-700 transition-colors duration-200">
                    Home
                </button>
                <button id="login-nav-btn" class="text-sm md:text-base font-semibold py-2 px-4 rounded-xl text-white bg-green-500 hover:bg-green-600 transition-colors duration-200">
                    Employee Login
                </button>
                <button id="logout-btn" class="hidden text-sm md:text-base font-semibold py-2 px-4 rounded-xl text-white bg-red-500 hover:bg-red-600 transition-colors duration-200">
                    Logout
                </button>
            </nav>
        </header>

        <!-- Dynamic Content Container -->
        <main class="flex-grow flex items-start justify-center">

            <!-- Home Page View (Public) -->
            <div id="home-view" class="w-full max-w-4xl">
                <h2 class="text-3xl font-bold text-center mb-6">Our Products</h2>
                <div class="overflow-x-auto bg-white rounded-3xl shadow-lg p-6">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Product</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Discount</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Final Price</th>
                            </tr>
                        </thead>
                        <tbody id="home-products-table-body" class="bg-white divide-y divide-gray-200">
                            <!-- Product rows will be dynamically inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Login Page View -->
            <div id="login-view" class="hidden bg-white rounded-3xl shadow-lg p-8 w-full max-w-sm">
                <h2 class="text-3xl font-bold text-center mb-6">Employee Login</h2>
                <p id="login-error" class="text-red-500 text-center mb-4 hidden">Invalid username or password.</p>
                <form id="login-form" class="space-y-4">
                    <div>
                        <label for="username" class="block text-sm font-medium text-gray-700">Username</label>
                        <input type="text" id="username" name="username" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                    <div>
                        <label for="password" class="block text-sm font-medium text-gray-700">Password</label>
                        <input type="password" id="password" name="password" class="mt-1 block w-full rounded-xl border-gray-300 shadow-sm p-3 focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white font-semibold py-3 px-4 rounded-xl hover:bg-blue-700 transition-colors duration-200 shadow-md">
                        Login
                    </button>
                </form>
            </div>

            <!-- Employee Dashboard View -->
            <div id="dashboard-view" class="hidden w-full max-w-6xl md:flex gap-6">
                <!-- Sidebar Navigation -->
                <aside class="w-full md:w-64 bg-white rounded-3xl shadow-lg p-6 flex flex-col flex-shrink-0">
                    <h2 class="text-2xl font-bold mb-6">Dashboard</h2>
                    <nav class="space-y-2">
                        <button id="view-products-tab" class="tab-button w-full text-left py-3 px-4 rounded-xl font-semibold bg-gray-100 text-blue-600 hover:bg-gray-200 transition-colors duration-200">
                            View/Search Products
                        </button>
                        <button id="add-edit-tab" class="tab-button w-full text-left py-3 px-4 rounded-xl font-semibold text-gray-700 hover:bg-gray-100 transition-colors duration-200">
                            Add/Edit Product
                        </button>
                    </nav>
                </aside>

                <!-- Dashboard Content Area -->
                <div class="flex-grow bg-white rounded-3xl shadow-lg p-8">

                    <!-- View/Search Products Tab Content -->
                    <div id="view-products-content" class="tab-content">
                        <h3 class="text-2xl font-bold mb-6">Product List</h3>
                        
                        <!-- Search Form -->
                        <div class="mb-6 flex gap-2">
                            <input type="text" id="search-input" placeholder="Search by ID or name..." class="flex-grow p-2 rounded-xl border border-gray-300 focus:ring-blue-500 focus:border-blue-500">
                            <button id="search-btn" class="bg-indigo-500 text-white font-semibold py-2 px-4 rounded-xl hover:bg-indigo-600 transition-colors duration-200">
                                Search
                            </button>
                            <button id="clear-search-btn" class="bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-xl hover:bg-gray-400 transition-colors duration-200">
                                Clear
                            </button>
                        </div>
                        
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-200 rounded-xl overflow-hidden">
                                <thead class="bg-gray-100">
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ID</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Stock</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Discount</th>
                                        <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="dashboard-products-table-body" class="bg-white divide-y divide-gray-200">
                                    <!-- Product rows will be dynamically inserted here -->
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Add/Edit Product Tab Content -->
                    <div id="add-edit-content" class="tab-content hidden">
                        <h3 class="text-2xl font-bold mb-6" id="form-title">Add New Product</h3>
                        <form id="product-form" class="space-y-4">
                            <input type="hidden" id="product-id">
                            <div>
                                <label for="product-name" class="block text-sm font-medium text-gray-700">Product Name</label>
                                <input type="text" id="product-name" class="mt-1 block w-full rounded-xl border-gray-300 p-2" required>
                            </div>
                            <div>
                                <label for="product-price" class="block text-sm font-medium text-gray-700">Price</label>
                                <input type="number" id="product-price" class="mt-1 block w-full rounded-xl border-gray-300 p-2" step="0.01" required>
                            </div>
                            <div>
                                <label for="product-stock" class="block text-sm font-medium text-gray-700">Stock</label>
                                <input type="number" id="product-stock" class="mt-1 block w-full rounded-xl border-gray-300 p-2" required>
                            </div>
                            <div>
                                <label for="product-discount" class="block text-sm font-medium text-gray-700">Discount (%)</label>
                                <input type="number" id="product-discount" class="mt-1 block w-full rounded-xl border-gray-300 p-2" min="0" max="100" value="0">
                            </div>
                            <div class="flex gap-2">
                                <button type="submit" id="submit-btn" class="flex-grow bg-green-500 text-white font-semibold py-2 px-4 rounded-xl hover:bg-green-600 transition-colors duration-200">
                                    Add Product
                                </button>
                                <button type="button" id="cancel-edit-btn" class="flex-grow hidden bg-gray-300 text-gray-800 font-semibold py-2 px-4 rounded-xl hover:bg-gray-400 transition-colors duration-200">
                                    Cancel
                                </button>
                            </div>
                        </form>
                    </div>

                </div>
            </div>

            <!-- Message box for user notifications -->
            <div id="message-box" class="fixed bottom-4 left-1/2 -translate-x-1/2 p-4 bg-gray-900 text-white rounded-xl shadow-lg transition-opacity duration-300 opacity-0 pointer-events-none z-50">
                <p id="message-text"></p>
            </div>

        </main>
    </div>

    <script>
        // Store all DOM elements for easy access
        const homeNavBtn = document.getElementById('home-nav-btn');
        const loginNavBtn = document.getElementById('login-nav-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const homeView = document.getElementById('home-view');
        const loginView = document.getElementById('login-view');
        const dashboardView = document.getElementById('dashboard-view');
        const loginForm = document.getElementById('login-form');
        const loginError = document.getElementById('login-error');
        const viewProductsTab = document.getElementById('view-products-tab');
        const addEditTab = document.getElementById('add-edit-tab');
        const viewProductsContent = document.getElementById('view-products-content');
        const addEditContent = document.getElementById('add-edit-content');
        const searchInput = document.getElementById('search-input');
        const searchBtn = document.getElementById('search-btn');
        const clearSearchBtn = document.getElementById('clear-search-btn');
        const homeProductsTableBody = document.getElementById('home-products-table-body');
        const dashboardProductsTableBody = document.getElementById('dashboard-products-table-body');
        const productForm = document.getElementById('product-form');
        const productIdInput = document.getElementById('product-id');
        const productNameInput = document.getElementById('product-name');
        const productPriceInput = document.getElementById('product-price');
        const productStockInput = document.getElementById('product-stock');
        const productDiscountInput = document.getElementById('product-discount');
        const submitBtn = document.getElementById('submit-btn');
        const cancelEditBtn = document.getElementById('cancel-edit-btn');
        const formTitle = document.getElementById('form-title');
        const messageBox = document.getElementById('message-box');
        const messageText = document.getElementById('message-text');

        // Function to show a temporary message box
        const showMessage = (text, type = 'info') => {
            messageText.textContent = text;
            messageBox.style.opacity = '1';
            messageBox.style.backgroundColor = type === 'error' ? '#EF4444' : '#1F2937';
            setTimeout(() => {
                messageBox.style.opacity = '0';
            }, 3000);
        };

        // Function to handle page navigation
        const showPage = (page) => {
            homeView.classList.add('hidden');
            loginView.classList.add('hidden');
            dashboardView.classList.add('hidden');
            loginNavBtn.classList.remove('hidden');
            logoutBtn.classList.add('hidden');
            homeNavBtn.classList.remove('bg-blue-700', 'bg-green-600', 'bg-red-600');
            loginNavBtn.classList.remove('bg-blue-700', 'bg-green-600', 'bg-red-600');
            
            if (page === 'home') {
                homeView.classList.remove('hidden');
                homeNavBtn.classList.add('bg-blue-700');
                renderProductsTable(JSON.parse(localStorage.getItem('products')) || [], 'home');
            } else if (page === 'login') {
                loginView.classList.remove('hidden');
                loginNavBtn.classList.add('bg-green-600');
            } else if (page === 'dashboard') {
                dashboardView.classList.remove('hidden');
                loginNavBtn.classList.add('hidden');
                logoutBtn.classList.remove('hidden');
                showDashboardTab('view-products');
            }
        };
        
        // Function to handle dashboard tab navigation
        const showDashboardTab = (tab) => {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.querySelectorAll('.tab-button').forEach(el => el.classList.remove('bg-gray-100', 'text-blue-600'));
            document.querySelectorAll('.tab-button').forEach(el => el.classList.add('text-gray-700'));
            
            if (tab === 'view-products') {
                viewProductsContent.classList.remove('hidden');
                viewProductsTab.classList.add('bg-gray-100', 'text-blue-600');
                renderProductsTable(JSON.parse(localStorage.getItem('products')) || [], 'dashboard');
            } else if (tab === 'add-edit') {
                addEditContent.classList.remove('hidden');
                addEditTab.classList.add('bg-gray-100', 'text-blue-600');
                productForm.reset();
                productIdInput.value = '';
                submitBtn.textContent = 'Add Product';
                formTitle.textContent = 'Add New Product';
                cancelEditBtn.classList.add('hidden');
            }
        };

        // Check login state and show the correct page on load
        document.addEventListener('DOMContentLoaded', () => {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            if (isLoggedIn === 'true') {
                showPage('dashboard');
            } else {
                showPage('home');
            }
        });

        // Event listeners for navigation buttons
        homeNavBtn.addEventListener('click', () => {
            showPage('home');
        });
        loginNavBtn.addEventListener('click', () => {
            showPage('login');
        });
        logoutBtn.addEventListener('click', () => {
            localStorage.removeItem('isLoggedIn');
            showPage('home');
            showMessage('You have been logged out.');
        });
        viewProductsTab.addEventListener('click', () => showDashboardTab('view-products'));
        addEditTab.addEventListener('click', () => showDashboardTab('add-edit'));

        // Event listener for the login form submission
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = e.target.username.value;
            const password = e.target.password.value;

            if (username === 'admin' && password === '1234') {
                localStorage.setItem('isLoggedIn', 'true');
                showPage('dashboard');
            } else {
                loginError.textContent = 'Invalid username or password.';
                loginError.classList.remove('hidden');
                setTimeout(() => loginError.classList.add('hidden'), 3000);
            }
        });

        // Event listener for the product form submission (Add/Edit)
        productForm.addEventListener('submit', (e) => {
            e.preventDefault();

            const products = JSON.parse(localStorage.getItem('products')) || [];
            const isEditing = productIdInput.value;
            const newProduct = {
                id: isEditing ? productIdInput.value : generateUniqueId(products),
                name: productNameInput.value,
                price: parseFloat(productPriceInput.value),
                stock: parseInt(productStockInput.value),
                discount: parseInt(productDiscountInput.value) || 0
            };

            if (isEditing) {
                // Edit existing product
                const index = products.findIndex(p => p.id === newProduct.id);
                if (index !== -1) {
                    products[index] = newProduct;
                    showMessage(`Product "${newProduct.name}" updated successfully!`);
                }
            } else {
                // Add new product
                products.push(newProduct);
                showMessage(`Product "${newProduct.name}" added successfully!`);
            }

            localStorage.setItem('products', JSON.stringify(products));
            showDashboardTab('view-products'); // Go back to product list after add/edit
        });
        
        // Event listener for search button
        searchBtn.addEventListener('click', () => {
            const products = JSON.parse(localStorage.getItem('products')) || [];
            const searchTerm = searchInput.value.toLowerCase();
            const filteredProducts = products.filter(p => 
                p.id.toLowerCase().includes(searchTerm) || 
                p.name.toLowerCase().includes(searchTerm)
            );
            renderProductsTable(filteredProducts, 'dashboard');
        });
        
        // Event listener for clear search button
        clearSearchBtn.addEventListener('click', () => {
            searchInput.value = '';
            renderProductsTable(JSON.parse(localStorage.getItem('products')) || [], 'dashboard');
        });
        
        // Event listener for cancel edit button
        cancelEditBtn.addEventListener('click', () => showDashboardTab('view-products'));

        // Function to generate a unique ID
        function generateUniqueId(products) {
            let lastId = parseInt(localStorage.getItem('lastProductId')) || 0;
            lastId++;
            localStorage.setItem('lastProductId', lastId);
            return 'PROD' + lastId.toString().padStart(4, '0');
        }

        // Function to render products into the table
        function renderProductsTable(products, target) {
            const tableBody = target === 'home' ? homeProductsTableBody : dashboardProductsTableBody;
            tableBody.innerHTML = '';
            
            if (products.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="6" class="p-4 text-center text-gray-500 italic">No products found.</td>`;
                tableBody.appendChild(row);
                return;
            }

            products.forEach(product => {
                const row = document.createElement('tr');
                row.classList.add('hover:bg-gray-50');
                const finalPrice = product.price * (1 - product.discount / 100);
                
                if (target === 'home') {
                    row.innerHTML = `
                        <td class="px-6 py-4 text-sm font-medium text-gray-900">${product.name}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">$${product.price.toFixed(2)}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${product.discount}%</td>
                        <td class="px-6 py-4 text-sm text-gray-900 font-semibold">$${finalPrice.toFixed(2)}</td>
                    `;
                } else { // dashboard
                    row.innerHTML = `
                        <td class="px-6 py-4 text-sm font-medium text-gray-900">${product.id}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${product.name}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">$${product.price.toFixed(2)}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${product.stock}</td>
                        <td class="px-6 py-4 text-sm text-gray-500">${product.discount}%</td>
                        <td class="px-6 py-4 text-sm font-medium text-center">
                            <button onclick="window.editProduct('${product.id}')" class="text-blue-600 hover:text-blue-900 mx-1">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                                </svg>
                            </button>
                            <button onclick="window.deleteProduct('${product.id}')" class="text-red-600 hover:text-red-900 mx-1">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline-block" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 10-2 0v6a1 1 0 102 0V8z" clip-rule="evenodd" />
                                </svg>
                            </button>
                        </td>
                    `;
                }
                tableBody.appendChild(row);
            });
        }

        // Global functions for buttons in the dashboard table
        window.editProduct = function(id) {
            const products = JSON.parse(localStorage.getItem('products')) || [];
            const product = products.find(p => p.id === id);
            if (product) {
                showDashboardTab('add-edit');
                formTitle.textContent = 'Edit Product';
                productIdInput.value = product.id;
                productNameInput.value = product.name;
                productPriceInput.value = product.price;
                productStockInput.value = product.stock;
                productDiscountInput.value = product.discount;
                submitBtn.textContent = 'Update Product';
                cancelEditBtn.classList.remove('hidden');
                showMessage(`Editing product: ${product.name}`);
            }
        }

        window.deleteProduct = function(id) {
            const products = JSON.parse(localStorage.getItem('products')) || [];
            const updatedProducts = products.filter(p => p.id !== id);
            localStorage.setItem('products', JSON.stringify(updatedProducts));
            renderProductsTable(updatedProducts, 'dashboard');
            showMessage(`Product with ID ${id} deleted successfully.`, 'error');
        }
    </script>
</body>
</html>
